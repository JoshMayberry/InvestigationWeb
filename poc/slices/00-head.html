<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Investigation Web — Three Virtues</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f1530; --text:#e8edff; --muted:#9aa6d1;
    --link:#44507a; --highlight:#ffd166; --stroke:#15204e;

    --endurance:#e74c3c;   /* red    */
    --harmony:#fdd835;     /* yellow */
    --remembrance:#1e90ff; /* blue   */
    --bridge:#b0bec5;

    --btn:#1b2460; --btnhl:#22307b; --ok:#28a745; --bad:#c0392b;
  }
  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text);
    font: 14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"; }
  #wrap { display: grid; grid-template-columns: 320px 1fr; grid-template-rows: auto 1fr; height: 100%; }
  header { grid-column: 1 / span 2; padding: 12px 16px; background: linear-gradient(180deg, #10183a, #0d1330);
    border-bottom: 1px solid #1b2460; display:flex; align-items:center; gap:12px; justify-content:space-between; }
  header .left { display:flex; align-items:center; gap:12px; }
  header h1 { font-size: 16px; margin: 0; letter-spacing: .2px; }
  header .sub { color: var(--muted); font-size: 12px; }
  header .toolbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .toolbar button { background: var(--btn); color: var(--text); border:1px solid #253177; border-radius:8px; padding:6px 10px; cursor:pointer; }
  .toolbar button.on { background: var(--btnhl); border-color:#4456c7; color: var(--highlight); box-shadow: 0 0 0 1px #ffd16666 inset; }
  .toolbar .seg { display:inline-flex; background:#0c1230; border:1px solid #22307b; border-radius:8px; overflow:hidden; }
  .toolbar .seg button{ border:0; border-right:1px solid #22307b; }
  .toolbar .seg button:last-child{ border-right:0; }

  aside { padding: 12px; background: var(--panel); border-right: 1px solid #1b2460; overflow:auto; }
  main { position: relative; }
  svg { width: 100%; height: 100%; display:block;
    background: radial-gradient(1200px 800px at 60% -10%, #162155 0%, #0b1020 60%); }
  .legend { display: grid; gap: 8px; margin-top: 8px; }
  .legend .row { display:flex; align-items:center; gap:8px; color: var(--muted); }
  .swatch { width: 12px; height: 12px; border-radius: 2px; border: 1px solid #0005; }
  .note { color: var(--muted); font-size: 12px; }

  .tip { position: absolute; pointer-events: none; opacity: 0; transform: translate(-50%, calc(-100% - 10px));
    background: #0e1537; color: var(--text); border: 1px solid #2a356f; border-radius: 8px; padding: 10px 12px;
    max-width: 380px; box-shadow: 0 6px 20px #0008; transition: opacity .12s ease; }
  .tip h3 { margin: 0 0 6px; font-size: 14px; }
  .tip p { margin: 0; color: var(--muted); }
  .tip .bonus { color: var(--highlight); margin-top: 6px; font-size: 12px; }

  .node { cursor: pointer; }
  .node circle.dot { stroke: var(--stroke); stroke-width: 1.25px; }

  /* halo base + toggle */
  .node .halo { display:none; opacity:0; pointer-events:none; stroke:#ffd166; stroke-width:3px; }
  .node.show-halo .halo { display:block; opacity:1; }

  /* Highlight the dot’s stroke to create a “ring” without the outer halo */
  .node.dot-hl circle.dot{
  stroke: #fff;                 /* was var(--highlight) */
  stroke-width: 2.5px;          /* a touch thicker helps readability */
  filter: drop-shadow(0 0 6px rgba(255,255,255,.7));  /* neutral glow */
}

  .label { fill: #c8d3ff; font-size: 11px; pointer-events: none; text-shadow: 0 1px 1px #000; }
  .link { stroke: var(--link); stroke-opacity: .55; cursor: pointer; }
  .link.selected { stroke-opacity: .95; }

  line.leader { stroke: #9aa6d1; stroke-width: .8px; stroke-opacity: .55; pointer-events: none; }
  .panel { margin-top:12px; padding-top:10px; border-top:1px solid #1b2460; }
  .panel h3 { margin:0 0 6px; font-size:12px; color:var(--muted); letter-spacing:.2px; text-transform:uppercase; }
  .filters { display:flex; flex-wrap:wrap; gap:6px; }
  .chip { padding:3px 8px; border:1px solid #2b397c; border-radius:999px; cursor:pointer; color:#c8d3ff; background:#0e1537; font-size:12px; }
  .chip.active { background:#22307b; }
  .search { width:100%; padding:6px 8px; border-radius:8px; border:1px solid #2b397c; background:#0c1233; color:#e8edff; }
  .dim { opacity:.18; }
  .match .dot { stroke:#ffe082; stroke-width:2px; }

  /* Edit visuals */
  .edit-wash { fill:none; stroke-width:22px; stroke-linecap:round; opacity:.14; }
  .edit-wash.highlight { opacity:.3; }
  .ghost-node { pointer-events:none; }
  .ghost-node.valid .dot { fill:#7fd37f66; stroke:#7fd37f; }
  .ghost-node.invalid .dot { fill:#d37f7f66; stroke:#d37f7f; }
  .ghost-link { pointer-events:none; stroke:#ffd166; stroke-dasharray:4 4; stroke-width:2px; opacity:.9; }

  /* Ghost specifically for transition drag */
  .ghost-node.transition .dot{ fill:#ffd16622; stroke:#ffd166; stroke-dasharray:4 3; }

  /* Edit side form */
  .edit-form label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 4px; }
  .edit-form input, .edit-form select, .edit-form textarea { width:100%; box-sizing:border-box; padding:6px 8px; border-radius:8px; border:1px solid #2b397c; background:#0c1233; color:#e8edff; }
  .edit-form .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .edit-form .actions{ display:flex; gap:8px; margin-top:12px; }
  .edit-form .actions button{ background: var(--btn); color: var(--text); border:1px solid #253177; border-radius:8px; padding:6px 10px; cursor:pointer; }
  .edit-form small{ color:var(--muted); }

  /* Link pills in Edit */
  .link-pills{ display:flex; flex-wrap:wrap; gap:6px; margin:4px 0 0; }
  .link-chip{ padding:3px 8px; border:1px solid #2b397c; border-radius:999px; cursor:pointer; background:#0e1537; color:#c8d3ff; font-size:12px; }
  .link-chip:hover{ background:#22307b; }
  .link-chip.selected{ background:#22307b; border-color:#4456c7; color:#ffd166; box-shadow: 0 0 0 1px #ffd16666 inset; }

  /* Swap target highlight (transition swap) */
  .node.swap-target .dot{ stroke:#ffd166; stroke-width:3px; }

  /* EDIT-ONLY link highlights */
  body.mode-edit .link.is-override {
    stroke: #ff6b6b;
    filter: drop-shadow(0 0 6px rgba(255,77,77,.75));
  }
  body.mode-edit .link.is-selected {
    stroke: #ffd166;
    filter: drop-shadow(0 0 8px rgba(255,209,102,.9));
  }
  
  .bonuses li {
    padding: 4px;
  }
</style>
</head>
<body>
<div id="wrap">
  <header>
    <div class="left">
      <h1>Investigation Web</h1>
      <div class="sub" id="subtitle">The Three Virtues of Promise — Endurance · Harmony · Remembrance</div>
    </div>
    <div class="toolbar">
      <div class="seg" id="modeSeg">
        <button data-mode="player">Player</button>
        <button data-mode="gm">GM</button>
        <button data-mode="edit">Edit</button>
      </div>
      <button id="btnUnlock">Unlock All</button>
      <button id="btnClear">Clear</button>
      <button id="btnOpen">Open JSON</button><input id="fileOpen" type="file" accept="application/json" style="display:none" />
      <button id="btnSave">Save JSON</button>
      <button id="btnResetZoom" title="Reset zoom">Reset View</button>
    </div>
  </header>